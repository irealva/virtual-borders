<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
<style>
.openseadragon-container img {
	padding-top: 5px !important;
	padding-left: 5px !important;
}

.buttons {
	float: right;
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
}

button {
	background: transparent;
	border: none;
	cursor: pointer;
    padding:0;

	background-color: #e0e0e0;
	border-radius: 999em;
	width: 25px;
	height: 25px;
	box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
	line-height: 1;
	font-size: 36px;
	position: relative;
	cursor: pointer;
    display: inline-flex !important;
	/*display: inline-block;*/
}

.visible {
    -webkit-animation: fadein 3s linear forwards;
    animation: fadein 3s linear forwards;
    opacity: 0;
}

.invisible {
    -webkit-animation: fadeout 3s linear forwards;
    animation: fadeout 3s linear forwards;
    opacity: 1;
}

@-webkit-keyframes fadein {
    100% { opacity: 1; }
}

@keyframes fadein {
    100% { opacity: 1; }
}

@-webkit-keyframes fadeout {
    100% { opacity: 0; }
}

@keyframes fadeout {
    100% { opacity: 0; }
}

button:hover {
    background-color: #eaeaea;
}

button i {
    font-size: 16px;
	color: #757575;
    left: 0;
    /*top: 50%;*/
    height: 100%;
    width: 100%;
    text-align: center;
    color: #FFF;
    position: relative;
}

.material-icons {
    font-size: 18px !important;
}

.material-icons.md-dark { color: rgba(0, 0, 0, 0.54); }
.material-icons.md-dark.md-inactive { color: rgba(0, 0, 0, 0.26); }

</style>

<div class='buttons visible' id='button-group'>
	<button type="button" id='zoomin'><i class="material-icons md-dark">&#xE145;</i></button>
	<button type="button" id='zoomout'><i class="material-icons md-dark">&#xE15B;</i></button>
	<button type="button" id='home'><i class="material-icons md-dark">&#xE88A;</i></button>
    <button type="button" id='fullscreen'><i class="material-icons md-dark">&#xE5D0;</i></button>
</div>

<div id="openseadragon1" style="width: 100%; height: 100%;"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="./openseadragon/openseadragon.min.js"></script>
<script src="./openseadragon/openseadragon-imaginghelper.min.js"></script>
<script src="./openseadragon/openseadragon-viewerinputhook.min.js"></script>
<script src="./openseadragon/openseadragon-canvas-overlay.js"></script>
<script type="text/javascript">
	var within = false;
	var canvas, width, height, widthLeftLimit, widthRightLimit, heightUpLimit, heightDownLimit;

	var viewer = OpenSeadragon({
			id: "openseadragon1",
			prefixUrl: "./openseadragon/images/",
			tileSources: "./USBig.dzi",
			constrainDuringPan: true,
			visibilityRatio: 1,
			zoomInButton:   "zoomin",
		    zoomOutButton:  "zoomout",
		    homeButton:     "home",
		    fullPageButton: "fullscreen"
	});

	var viewerInputHook = viewer.addViewerInputHook({ hooks: [
		{tracker: 'viewer', handler: 'moveHandler', hookHandler: onMove},
		{tracker: 'viewer', handler: 'enterHandler', hookHandler: onEnter },
		{tracker: 'viewer', handler: 'exitHandler', hookHandler: onExit }
	]});

	// var imagingHelper = new OpenSeadragonImaging.ImagingHelper({viewer: viewer});

	var imagingHelper = viewer.activateImagingHelper({
		// onImageViewChanged: onImageViewChanged
	});

	var overlay = viewer.canvasOverlay({
		onRedraw: function() {
			var ctx = overlay.context2d();
			var IMAGE_HEIGHT = viewer.world._contentSize.y;
			var IMAGE_WIDTH = viewer.world._contentSize.x;
			var FONT_SIZE = 75;
			var PADDING = 10;

			ctx.fillStyle = '#666';
			ctx.font = "100px Lato";
  			ctx.fillText("United States", 0, -PADDING);
			ctx.fillText("Mexico", 0, IMAGE_HEIGHT + FONT_SIZE + PADDING);
		},
		clearBeforeRedraw:true
	});

    /* button show or hide */
    // var x = false;
    // document.addEventListener('mousemove', function() {
    //     console.log("mousemove");
    //     if (x) {
    //         clearTimeout(x);
    //     }
    //     x = setTimeout(function()
    // 	{
    //         return true;
    // 	}, 200);
    // }, false);
    var timeout = null;

    document.addEventListener('mousemove', function() {
        if (timeout !== null) {
            var buttons = document.getElementById('button-group');
            buttons.className = 'buttons visible'
            clearTimeout(timeout);
        }

        timeout = setTimeout(function() {
            var buttons = document.getElementById('button-group');
            buttons.className = 'buttons invisible'
            console.log("idle");
        }, 2500);
    });


    /* button show or hide */

	var mleft, mright, mup, mdown;
	var booleanleft = false;
	var booleanright = false;
	var booleanup = false;
	var booleandown = false;

	function onEnter (event) {
		within = true;
	}

	function onExit (event) {
		within = false;
		clearInterval(mright);
		clearInterval(mleft);
		clearInterval(mup);
		clearInterval(mdown);
		booleanright = false;
		booleanleft = false;
		booleanup = false;
		booleandown = false;
	}

	var MOVE_HORIZONTAL_INTERVAL = 0.0003;
	var MOVE_HORIZONTAL_INTERVAL_MAX = 0.001;
	var MOVE_HORIZONTAL_INTERVAL_MIN = 0.0002
	var MOVE_VERTICAL_INTERVAL = 0.0001;
	var MOVE_TIME = 50;

	function onMove (event) {
		if (within) {
			var zoom = viewer.viewport.getZoom();
			var x = imagingHelper.physicalToLogicalX(event.position.x);
			var y = imagingHelper.physicalToLogicalY(event.position.y);

			if (x < 0) {
				clearInterval(mleft);
			}
			else if (x > 1) {
				clearInterval(mright);
			}

			// To move image left
			if (event.position.x < widthLeftLimit && x > 0) {
				MOVE_HORIZONTAL_INTERVAL = map_range(event.position.x, widthLeftLimit, 0,  MOVE_HORIZONTAL_INTERVAL_MIN, MOVE_HORIZONTAL_INTERVAL_MAX);

				if (booleanleft === false) {
					mleft = setInterval(moveLeft, MOVE_TIME);
					booleanleft = true;
				}
			}
			else if (event.position.x >= widthLeftLimit) {
				clearInterval(mleft);
				booleanleft = false;
			}

			// To move image right
			if (event.position.x > widthRightLimit) {
				MOVE_HORIZONTAL_INTERVAL = map_range(event.position.x, widthRightLimit, width,  MOVE_HORIZONTAL_INTERVAL_MIN, MOVE_HORIZONTAL_INTERVAL_MAX);

				if (booleanright === false) {
					mright = setInterval(moveRight, MOVE_TIME);
					booleanright = true;
				}
			}
			else if (event.position.x <= widthRightLimit) {
				clearInterval(mright);
				booleanright = false;
			}

			// To move image up
			if (event.position.y < heightUpLimit) {
				if (booleanup === false) {
					mup = setInterval(moveUp, MOVE_TIME);
					booleanup = true;
				}
			}
			else if (event.position.y >= heightUpLimit) {
				clearInterval(mup);
				booleanup = false;
			}

			// To move image down
			if (event.position.y > heightDownLimit) {
				if (booleandown === false) {
					mdown = setInterval(moveDown, MOVE_TIME);
					booleandown = true;
				}
			}
			else if (event.position.y <= heightDownLimit) {
				clearInterval(mdown);
				booleandown = false;
			}
		}
	}

	function moveDown () {
		var point = new OpenSeadragon.Point(0,MOVE_VERTICAL_INTERVAL)
		viewer.viewport.panBy(point);
		viewer.viewport.ensureVisible();
	}

	function moveUp () {
		var point = new OpenSeadragon.Point(0,-MOVE_VERTICAL_INTERVAL)
		viewer.viewport.panBy(point);
		viewer.viewport.ensureVisible();
	}

	function moveRight () {
		var point = new OpenSeadragon.Point(MOVE_HORIZONTAL_INTERVAL,0)
		viewer.viewport.panBy(point);
	}

	function moveLeft () {
		var point = new OpenSeadragon.Point(-MOVE_HORIZONTAL_INTERVAL,0)
		viewer.viewport.panBy(point);
	}

	$(window).on('load', function()
	{
		calculateDimentions();
	});

	$(window).on('resize', function () {
		calculateDimentions();
	});

	function calculateDimentions () {
		canvas = document.getElementsByClassName('openseadragon-canvas')[0];
		width = canvas.offsetWidth;
		height = canvas.offsetHeight;

		widthLeftLimit = (width / 4);
		widthRightLimit = width - widthLeftLimit;

		heightUpLimit = (height / 6);
		heightDownLimit = height - heightUpLimit;
	}

	function map_range(value, low1, high1, low2, high2) {
		return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
	}
</script>
